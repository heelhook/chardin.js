(function(){var t={};!function(e,i){var n;return n=function(){function t(t){i.chardinTimeouts=[],this.$el=e(t),this.clickBlacklist="",this.helperLayers={},this.zIndexSuspendedElements=[],this.transitionEndEvent="transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd"}return t.prototype.preOverlaySetup=function(){},t.prototype.postOverlaySetup=function(){},t.prototype.getElements=function(){return this.$el.find("*[data-intro]:visible")},t.prototype.showElement=function(t){this._showElement(t)},t.prototype.finalSetup=function(){this.finished=!0},t.prototype.destroy=function(){},t.prototype.forceSetupCompletion=function(){},t.prototype.registerTimeout=function(t,e){i.chardinTimeouts.push(_.delay(t,e))},t.prototype.removeTooltips=function(t){var t=t||"";this.$el.find(".chardin-helper-layer"+t).remove(),this.$el.find(".chardin-show-element"+t).removeClass("chardin-show-element"),this.$el.find(".chardin-relative-position"+t).removeClass("chardin-relative-position")},t.prototype.restoreClick=function(){document.removeEventListener("click",this.clickInterceptorBound,!0)},t.prototype.start=function(){return this._overlayVisible()?!1:(this.refreshBound=this._refresh.bind(this),e(i).on("resize",this.refreshBound),this.preOverlaySetup(),this._addOverlayLayer(),this._suspendZIndexes(),this.postOverlaySetup(),_(this.getElements()).each(this.showElement,this),this.clickBlacklist&&this._disableClick(),this._enableEsc(),this.$el.trigger("chardin:start"),void this.finalSetup())},t.prototype.stop=function(){var t=this.$el.find(".chardin-overlay");e(i).off("keyup",this.onEscBound),e(i).off("resize",this.refreshBound),this.restoreClick(),this.destroy(),this._clearTimeouts(),this.removeTooltips(),t.css(this.transition("opacity 0.4s")).css("opacity",0),t.on(this.transitionEndEvent,function(){t.remove()}),this._replaceZIndexes(),this.$el.trigger("chardin:stop")},t.prototype.toggle=function(){return this._overlayVisible()?this.stop():this.start()},t.prototype.transition=function(t){return{transition:t,"-webkit-transition":t,"-moz-transition":t,"-ms-transition":t,"-o-transition":t}},t.prototype._addOverlayLayer=function(){var t,i,n=this;return this._overlayVisible()?!1:(t=e("<div>").addClass("chardin-overlay"),this.$el.is("body")?t.css({top:0,bottom:0,right:0,left:0,position:"fixed"}):(i=this._getOffset(this.$el),i&&overlay.css(i)),t.appendTo(this.$el).click(function(){n.finished&&n.stop()}),void this.registerTimeout(function(){t.css("opacity",.8)},10))},t.prototype._clearTimeouts=function(){for(;i.chardinTimeouts.length;){var t=i.chardinTimeouts.pop();clearTimeout(t)}},t.prototype._clickInterceptor=function(t){var i=e(t.target);i.is(this.clickBlacklist)&&(t.stopPropagation(),t.preventDefault())},t.prototype._climbTree=function(t){for(var i,n=e(t).parent();n.parent().length;)i=n.css("z-index"),"auto"!==i&&(n.css("z-index","auto").data("chardin-suspended",i),this.zIndexSuspendedElements.push(n[0])),n=n.parent()},t.prototype._disableClick=function(){this.clickInterceptorBound=this._clickInterceptor.bind(this),document.addEventListener("click",this.clickInterceptorBound,!0)},t.prototype._enableEsc=function(){this.onEscBound=this._onEsc.bind(this),e(i).on("keyup",this.onEscBound)},t.prototype._getOffset=function(t){var i=e(t);return _.extend({width:i.outerWidth(),height:i.outerHeight()},i.offset())},t.prototype._getPosition=function(t){return e(t).data("position")||"bottom"},t.prototype._onEsc=function(t){27===t.keyCode&&(this._clearTimeouts(),this.foreceSetupCompletion(),this.stop())},t.prototype._overlayVisible=function(){return 0!==!this.$el.find(".chardin-overlay").length},t.prototype._placeTooltip=function(t,i){var n=e(i),s=this._getOffset(i),o=this._getOffset(t);switch(n.css({top:null,right:null,bottom:null,left:null}),this._getPosition(t)){case"bottom":n.css("left",(o.width-s.width)/2);break;case"right":n.css("top",(o.height-s.height)/2)}switch(this._getPosition(t)){case"left":return i.style.left="-"+(s.width-34)+"px";case"right":return i.style.right="-"+(s.width-34)+"px";case"bottom":return i.style.bottom="-"+s.height+"px";case"top":return i.style.top="-"+s.height+"px"}},t.prototype._positionHelperLayer=function(t){this.helperLayers[e(t).data("chardin-id")].css(this._getOffset(t))},t.prototype._refresh=function(){this._overlayVisible()&&_(this.getElements()).each(this._positionHelperLayer,this)},t.prototype._replaceZIndexes=function(){for(var t;this.zIndexSuspendedElements.length;)t=this.zIndexSuspendedElements.pop(),e(t).attr("style",function(t,i){var n=e(this),s=n.data("chardin-suspended");return n.removeData("chardin-suspended"),i.replace(/z-index: auto; ?/g,"z-index: "+s+"; ")})},t.prototype._showElement=function(t){var i,n=e(t),s=_.uniqueId(),o=e("<div>").addClass("chardin-helper-layer"),r=e("<div>").addClass("chardin-tooltip"),a=e("<div>").addClass("chardin-tooltiptext").text(n.data("intro"));n.data("chardin-id",s),n.attr("id")&&o.data("id",n.attr("id")),this.helperLayers[s]=o,this._positionHelperLayer(t),o.add(r).addClass("chardin-"+this._getPosition(t)),r.append(a),o.append(r),this.$el.append(o),this._placeTooltip(t,r[0]),n.addClass("chardin-show-element"),i=n.css("position"),"absolute"!==i&&"relative"!==i&&n.addClass("chardin-relative-position")},t.prototype._suspendZIndexes=function(){_(this.getElements()).each(this._climbTree,this)},t}(),e.fn.extend({chardin:function(){var i,s,o,r,a;return r=arguments[0],a=arguments[1],s=3<=arguments.length?_.toArray(arguments).slice(2):[],i=e(this[0]),o=i.data("chardin"),a&&t[a](n),o||i.data("chardin",o=new n(this,r)),"string"==typeof r&&o[r].apply(o,s),o}})}(window.jQuery,window)}).call(this);